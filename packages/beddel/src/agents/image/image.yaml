# Image Generator Agent - Declarative Genkit workflow
# Route: /agents/image
# Method: image.generate

agent:
  id: image
  version: 1.0.0
  protocol: beddel-declarative-protocol/v2.0

metadata:
  name: "Image Generator Agent"
  description: "Generates images using Gemini Flash with curated styles"
  category: "creative"
  route: "/agents/image"

schema:
  input:
    type: "object"
    properties:
      description:
        type: "string"
        minLength: 5
        maxLength: 500
        description: "Detailed textual description of the scene"
      style:
        type: "string"
        enum: ["watercolor", "neon", "sketch"]
        description: "Desired visual style"
      resolution:
        type: "string"
        pattern: "^[0-9]{3,4}x[0-9]{3,4}$"
        description: "Resolution in WIDTHxHEIGHT format (e.g., 1024x1024)"
    required: ["description", "style", "resolution"]

  output:
    type: "object"
    properties:
      image_url:
        type: "string"
      image_base64:
        type: "string"
      media_type:
        type: "string"
      prompt_used:
        type: "string"
      metadata:
        type: "object"
        properties:
          model_used:
            type: "string"
          processing_time:
            type: "number"
          style:
            type: "string"
          resolution:
            type: "string"
        required: ["model_used", "processing_time", "style", "resolution"]
    required: ["image_url", "prompt_used", "metadata"]

logic:
  workflow:
    - name: "generate-image"
      type: "genkit-image"
      action:
        type: "image"
        result: "imageResult"
        promptTemplate: "Create an image in {{style}} style focusing on: {{description}}"

    - name: "deliver-image"
      type: "output-generator"
      action:
        type: "generate"
        output:
          image_url: "$imageResult.image_url"
          image_base64: "$imageResult.image_base64"
          media_type: "$imageResult.media_type"
          prompt_used: "$imageResult.prompt_used"
          metadata: "$imageResult.metadata"

output:
  schema:
    image_url: "$imageResult.image_url"
    image_base64: "$imageResult.image_base64"
    media_type: "$imageResult.media_type"
    prompt_used: "$imageResult.prompt_used"
    metadata: "$imageResult.metadata"
